<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="style.css" rel="stylesheet" />
    <link href="checkout.css" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <title>Checkout</title>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>{{ sitename }}</h1>
      </header>
      <main>
        <h2>Checkout</h2>
        <h3>hi there</h3>

        <div class="checkout-container">
          <!-- Shipping Details -->
          <div class="shipping-details">
            <h2>Shipping Details</h2>
            <p>
              <strong>Last Name:</strong> <input v-model="order.firstName" />
            </p>
            <p>
              <strong>Last Name:</strong> <input v-model="order.lastName" />
            </p>
            <p><strong>Address:</strong> <input v-model="order.address" /></p>
            <p><strong>City:</strong> <input v-model="order.city" /></p>
            <p>
              <strong>State:</strong>
              <select v-model="order.state">
                <option disabled value="">State</option>
                <option v-for="(state, key) in states" :value="key">
                  {{ state }}
                </option>
              </select>
            </p>
            <p>
              <strong>Zip/Postal Code:</strong>
              <input v-model.number="order.zip" type="number" />
            </p>
            <p>
              <strong>Contact:</strong>
              <input v-model.number="order.phone" type="number" />
            </p>
          </div>

          <div class="order-summary">
            <h2>Order Summary</h2>
            <p><strong>First Name:</strong> {{ order.firstName }}</p>
            <p><strong>Last Name:</strong> {{ order.lastName }}</p>
            <p><strong>Address:</strong> {{ order.address }}</p>
            <p><strong>City:</strong> {{ order.city }}</p>
            <p><strong>State:</strong> {{ order.state }}</p>
            <p><strong>Zip/Postal Code:</strong> {{ order.zip }}</p>
            <p><strong>Contact:</strong> {{ order.phone }}</p>
            <p><strong>Total Amount:</strong> {{ totalPrice }} AED</p>

            <h2>Payment Method</h2>
            <div>
              <input
                type="radio"
                id="credit"
                value="Credit Card"
                v-model="paymentMethod"
              />
              <label for="credit">Credit Card</label>
              <br />
              <input
                type="radio"
                id="paypal"
                value="PayPal"
                v-model="paymentMethod"
              />
              <label for="paypal">PayPal</label>
            </div>
            <p><strong>Selected Payment Method:</strong> {{ paymentMethod }}</p>

            <!-- Alert message -->
            <p class="alert" v-if="validationMessage">
              {{ validationMessage }}
            </p>

            <button v-on:click="goBack">Back to Activities</button>
            <button v-on:click="submitForm">Place Order</button>
          </div>
        </div>
      </main>
    </div>

    <script type="text/javascript">
      var checkoutPage = new Vue({
        el: "#app",
        data: {
          sitename: "After School Explorers - Checkout",
          cart: [],
          order: {
            firstName: "",
            lastName: "",
            address: "",
            city: "",
            zip: "",
            state: "",
            phone: "",
          },
          paymentMethod: "",
          validationMessage: "",
          states: {
            AL: "Alabama",
            AR: "Arizona",
            CA: "California",
            NV: "Nevada",
          },
        },
        computed: {
          totalPrice() {
            return this.cart
              .reduce((sum, item) => {
                const priceValue =
                  typeof item.price === "number"
                    ? item.price
                    : parseFloat(item.price.replace(/[^0-9.-]+/g, ""));
                return sum + (isNaN(priceValue) ? 0 : priceValue);
              }, 0)
              .toFixed(2);
          },
        },
        methods: {
          submitForm: function () {
            if (
              !this.order.firstName ||
              !this.order.lastName ||
              !this.order.address ||
              !this.order.city ||
              !this.order.zip ||
              !this.order.state ||
              !this.order.phone ||
              !this.paymentMethod
            ) {
              this.validationMessage =
                "Please fill in all fields and select a payment method.";
              return;
            }

            this.validationMessage = "";
            alert(`Order Submitted! Payment Method: ${this.paymentMethod}`);
            this.cart = [];
            localStorage.setItem("cart", JSON.stringify(this.cart));
            window.location.href = "index.html";
          },
          goBack: function () {
            window.location.href = "index.html";
          },
        },
        created() {
          const cartData = localStorage.getItem("cart");
          if (cartData) {
            this.cart = JSON.parse(cartData);
          } else {
            console.log("Cart is empty or not found in localStorage.");
          }
        },
      });
    </script>
  </body>
</html>
